<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Model Viewer</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: transparent;
    }
    #model-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    #error-message {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background: rgba(0,0,0,0.5);
      color: white;
      font-family: Arial, sans-serif;
      padding: 10px;
      text-align: center;
      font-size: 12px;
      z-index: 100;
      display: none;
    }
    #loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.2);
      color: white;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="model-container">
    <div id="loading">Loading model...</div>
    <div id="error-message"></div>
  </div>

  <script>
    // Use a more reliable way to load the scripts
    function loadScript(url) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = url;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`Failed to load script: ${url}`));
        document.head.appendChild(script);
      });
    }

    // Parse URL parameters to get model path
    const urlParams = new URLSearchParams(window.location.search);
    const modelPath = urlParams.get('model');
    const errorElement = document.getElementById('error-message');
    const loadingElement = document.getElementById('loading');
    
    // Function to show error
    function showError(message, details = '') {
      errorElement.innerHTML = `<strong>${message}</strong><br><small>${details}</small>`;
      errorElement.style.display = 'flex';
      loadingElement.style.display = 'none';
    }

    // If no model path is provided, show error
    if (!modelPath) {
      showError('No model specified');
    } else {
      // Load required scripts in sequence
      Promise.all([
        loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js'),
        loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js'),
        loadScript('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js')
      ])
      .then(() => {
        // Initialize Three.js scene
        const scene = new THREE.Scene();
        scene.background = null; // Transparent background
        
        // Camera setup
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        
        // Renderer setup
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0); // Transparent background
        document.getElementById('model-container').appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(0, 1, 0);
        scene.add(directionalLight);
        
        // Controls for model interaction
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableZoom = false;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2;
        
        // Log the model path for debugging
        console.log('Loading model from:', modelPath);
        
        // Load the model
        const loader = new THREE.GLTFLoader();
        loader.load(
          modelPath,
          (gltf) => {
            // Hide loading indicator
            loadingElement.style.display = 'none';
            
            const model = gltf.scene;
            
            // Calculate bounding box to center and scale the model appropriately
            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3()).length();
            const center = box.getCenter(new THREE.Vector3());
            
            // Normalize and center the model
            model.position.x = -center.x;
            model.position.y = -center.y;
            model.position.z = -center.z;
            
            // Adjust the scale of the model
            const scale = 2.0 / size;
            model.scale.set(scale, scale, scale);
            
            scene.add(model);
            console.log('Model loaded successfully');
          },
          (xhr) => {
            // Loading progress
            const percentComplete = (xhr.loaded / xhr.total) * 100;
            loadingElement.textContent = `Loading: ${Math.round(percentComplete)}%`;
            console.log(`${Math.round(percentComplete)}% loaded`);
          },
          (error) => {
            console.error('Error loading model:', error);
            showError('Failed to load 3D model', `Path: ${modelPath}<br>Error: ${error.message}`);
          }
        );
        
        // Handle window resize
        window.addEventListener('resize', () => {
          const width = window.innerWidth;
          const height = window.innerHeight;
          
          camera.aspect = width / height;
          camera.updateProjectionMatrix();
          
          renderer.setSize(width, height);
        });
        
        // Animation loop
        function animate() {
          requestAnimationFrame(animate);
          controls.update();
          renderer.render(scene, camera);
        }
        
        animate();
      })
      .catch(error => {
        console.error('Error loading scripts:', error);
        showError('Failed to load required scripts', error.message);
      });
    }
  </script>
</body>
</html> 